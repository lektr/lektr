# syntax=docker/dockerfile:1.4

# =============================================================================
# Development Dockerfile - Optimized for speed and hot reload
# =============================================================================

FROM node:25-slim

WORKDIR /app

# Install basic tools for debugging
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Copy root workspace files
COPY package.json package-lock.json ./

# Build shared types first (this rarely changes)
WORKDIR /app/lektr-shared
COPY lektr-shared/package.json lektr-shared/tsconfig.json ./
COPY lektr-shared/src ./src
RUN npm install && npm run build

# Install API dependencies
WORKDIR /app/lektr-api
COPY lektr-api/package.json ./
RUN npm install

# Create HuggingFace cache directory for embedding models
RUN mkdir -p /app/.cache/huggingface
ENV HF_HOME=/app/.cache/huggingface

# Install UI dependencies
WORKDIR /app/lektr-ui
COPY lektr-ui/package.json ./
COPY lektr-ui/tsconfig.json lektr-ui/next.config.mjs lektr-ui/postcss.config.mjs ./
RUN npm install

WORKDIR /app
